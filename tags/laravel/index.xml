<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Laravel on </title>
    <link>/tags/laravel/</link>
    <description>Recent content in Laravel on </description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Tue, 18 Aug 2015 22:09:24 +0900</lastBuildDate>
    <atom:link href="/tags/laravel/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>laravel&#43;Keen.io&#43;herokuで簡易解析</title>
      <link>/post/laravel-keenio-heroku/</link>
      <pubDate>Tue, 18 Aug 2015 22:09:24 +0900</pubDate>
      
      <guid>/post/laravel-keenio-heroku/</guid>
      <description>

&lt;p&gt;とあるシステムで簡単なアクセス解析をする必要があったため、&lt;br /&gt;
せっかくなので存在だけは知っていたKeen.ioを使ってみた。&lt;/p&gt;

&lt;h2 id=&#34;keen-io:b76c980995b62bffde186cba016701cc&#34;&gt;keen.io&lt;/h2&gt;

&lt;p&gt;keen.ioはかしこいんだよねー。keen.ioはかしこいんだよねー。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>laravel5.1でschedule &#43; メール送信 &#43; Heroku</title>
      <link>/post/laravel-schedule-mail-heroku/</link>
      <pubDate>Tue, 28 Jul 2015 19:47:10 +0900</pubDate>
      
      <guid>/post/laravel-schedule-mail-heroku/</guid>
      <description>

&lt;h2 id=&#34;schedule:6aa5f35fed2f498892b0237b45ad7cb5&#34;&gt;Schedule&lt;/h2&gt;

&lt;p&gt;Laravel5.1ではスケジューラによるcron処理が可能。&lt;br /&gt;
利用方法は以下。&lt;/p&gt;

&lt;h3 id=&#34;laravel側の設定:6aa5f35fed2f498892b0237b45ad7cb5&#34;&gt;Laravel側の設定&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;Console/Kernel.php&lt;/code&gt; 内&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;protected function schedule(Schedule $schedule)
{
    $schedule-&amp;gt;command(&#39;inspire&#39;)
             -&amp;gt;hourly();

    $schedule-&amp;gt;command(&#39;user:change-password 5365576&#39;)
            -&amp;gt;everyFiveMinutes();
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;こんな感じでコマンドを登録しておく。&lt;br /&gt;
関数群は以下↓&lt;br /&gt;
&lt;a href=&#34;http://readouble.com/laravel/5/1/ja/scheduling.html&#34;&gt;http://readouble.com/laravel/5/1/ja/scheduling.html&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;crontabの設定:6aa5f35fed2f498892b0237b45ad7cb5&#34;&gt;crontabの設定&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;$ crontab -e
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以下のコマンドをファイルに記述&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;* * * * * php /path/to/artisan schedule:run 1&amp;gt;&amp;gt; /dev/null 2&amp;gt;&amp;amp;1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;要は「毎秒cron走らせて、phpの関数で実行時間を管理」するということらしい。&lt;/p&gt;

&lt;h2 id=&#34;メール:6aa5f35fed2f498892b0237b45ad7cb5&#34;&gt;メール&lt;/h2&gt;

&lt;p&gt;Laravel内部では、&lt;a href=&#34;https://github.com/swiftmailer/swiftmailer&#34;&gt;SwiftMailer&lt;/a&gt; というPHPライブラリを利用している。&lt;br /&gt;
デフォルトでサポートされているドライバーは、&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;smtp&lt;/li&gt;
&lt;li&gt;mail&lt;/li&gt;
&lt;li&gt;sendmail&lt;/li&gt;
&lt;li&gt;mailgun&lt;/li&gt;
&lt;li&gt;mandrill&lt;/li&gt;
&lt;li&gt;ses(amazon simple email service)&lt;/li&gt;
&lt;li&gt;log&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;というラインナップ。「log」は &lt;strong&gt;開発環境で送信結果のみをログ・ファイルに出力&lt;/strong&gt; など開発環境向き。&lt;br /&gt;
とりわけメールのテストは面倒くさいのでこういった気遣いはありがたい。
が、せっかくなので、テストはLaravel推奨の&lt;a href=&#34;https://mailtrap.io/&#34;&gt;mailtrap.io&lt;/a&gt; を利用する。&lt;br /&gt;
productionではherokuを利用することを想定し、無料枠のあるmailgun（400/day）を使う。&lt;/p&gt;

&lt;h3 id=&#34;開発環境:6aa5f35fed2f498892b0237b45ad7cb5&#34;&gt;開発環境&lt;/h3&gt;

&lt;p&gt;とりま &lt;code&gt;guzzle&lt;/code&gt;をcomposerに。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;quot;require&amp;quot;: {
    &amp;quot;guzzlehttp/guzzle&amp;quot;: &amp;quot;~5.3|~6.0&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で、&lt;code&gt;$ composer update&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://mailtrap.io/&#34;&gt;https://mailtrap.io/&lt;/a&gt; →「Sing up」から、アカウントを作成。&lt;br /&gt;
OAuthでサクッとやっちまうのがラク。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/images/InboxesMailtrap.png&#34; alt=&#34;InboxesMailtrap.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ログインページに遷移したら、「Demo inbox」をクリック&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/images/Demo_inboxMailtrap.png&#34; alt=&#34;Demo_inboxMailtrap.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;モザイクかかってるUsernameとPasswordを&lt;code&gt;.env&lt;/code&gt; にいれればおｋ．&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-env&#34;&gt;MAIL_DRIVER=smtp
MAIL_HOST=mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME=[mailtrap_smtp_username]
MAIL_PASSWORD=[mailtrap_smtp_password]
MAIL_ENCRYPTION=null
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;上記を設定した状態で、&lt;a href=&#34;http://readouble.com/laravel/5/1/ja/mail.html&#34;&gt;http://readouble.com/laravel/5/1/ja/mail.html&lt;/a&gt; の「メール送信」項目を参考にコードを書けばまあ動くだろう。&lt;/p&gt;

&lt;h3 id=&#34;mailgunの設定:6aa5f35fed2f498892b0237b45ad7cb5&#34;&gt;mailgunの設定&lt;/h3&gt;

&lt;p&gt;さてお次はmailgunの設定。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ heroku addons:create mailgun:starter -a APP_NAME
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;でmailgunの無料プランを追加。&lt;/p&gt;

&lt;p&gt;次に、&lt;code&gt;config/services.php&lt;/code&gt; 以下のmailgunにdomainとsecretを記入。&lt;br /&gt;
若干わかりづらかったが、&lt;/p&gt;

&lt;p&gt;・ドメイン
&lt;img src=&#34;/images/Domains_Mailgun.png&#34; alt=&#34;Domains_Mailgun.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;・secret
&lt;img src=&#34;/images/mailgun_apikey.png&#34; alt=&#34;mailgun_apikey.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;である。（モザイクだらけ）&lt;/p&gt;

&lt;p&gt;あとは、&lt;code&gt;mail.php&lt;/code&gt; をちょちょいと修正（ユーザー名とかパスワードとか）を入れればおｋ.&lt;br /&gt;
herokuの環境変数にセットアップされているので、productionからはそっちから呼ばせても良い。&lt;/p&gt;

&lt;h2 id=&#34;herokuでの運用:6aa5f35fed2f498892b0237b45ad7cb5&#34;&gt;herokuでの運用&lt;/h2&gt;

&lt;p&gt;さて、schedule + メールという処理が開発環境で動くところまでは説明したが、&lt;br /&gt;
ここまでやっといて何だけど、herokuからはLaravelのscheduleは &lt;strong&gt;使えない。&lt;/strong&gt;&lt;br /&gt;
cronの設定が出来ないから。&lt;br /&gt;
ただし、そんなときのために &lt;strong&gt;heroku scheduler&lt;/strong&gt; がある。&lt;/p&gt;

&lt;h2 id=&#34;heroku-schedulerのインストール:6aa5f35fed2f498892b0237b45ad7cb5&#34;&gt;heroku schedulerのインストール&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;$ heroku addons:create scheduler:standard -a APP_NAME
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;でheroku schedulerをインストール。&lt;/p&gt;

&lt;h2 id=&#34;schedulerの設定:6aa5f35fed2f498892b0237b45ad7cb5&#34;&gt;schedulerの設定&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;/images/Heroku_Scheduler.png&#34; alt=&#34;Heroku_Scheduler.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;$&lt;/code&gt; マーク以後に、実行させたいコマンドを入力し、 FREQUENCYから実行タイミングを指定すれば良い。最短は &lt;strong&gt;10分&lt;/strong&gt; である。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>